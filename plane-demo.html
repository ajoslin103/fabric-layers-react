<!DOCTYPE html>
<html>
<head>
    <title>Fabric Layers React Demo</title>
    <style>
        .canvas-container {
            margin: 20px;
            border: 1px solid #ccc;
        }
        .controls {
            margin: 20px;
        }
        button {
            margin-right: 10px;
            padding: 8px 16px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Load Fabric.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/6.0.0-beta16/fabric.min.js"></script>
    
    <!-- Load fabric-layers -->
    <script src="https://unpkg.com/fabric-layers@1.1.3/dist/index.js"></script>

    <!-- Load Babel for JSX support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Our component -->
    <script type="text/babel" data-type="module">
        // Check if fabric is available
        if (!window.fabric) {
            console.error('Fabric.js not found. Make sure it is loaded before this script.');
        } else {
            console.log('Fabric.js version:', fabric.version);
        }

        // Simple demo component
        function Demo() {
            const [activeLayer, setActiveLayer] = React.useState(0);
            const canvasRef = React.useRef(null);

            const addRectangle = () => {
                if (canvasRef.current) {
                    const rect = new fabric.Rect({
                        left: 100,
                        top: 100,
                        width: 50,
                        height: 50,
                        fill: 'red'
                    });
                    canvasRef.current.getActiveLayer().add(rect);
                    canvasRef.current.renderAll();
                }
            };

            const addCircle = () => {
                if (canvasRef.current) {
                    const circle = new fabric.Circle({
                        left: 200,
                        top: 100,
                        radius: 30,
                        fill: 'blue'
                    });
                    canvasRef.current.getActiveLayer().add(circle);
                    canvasRef.current.renderAll();
                }
            };

            const switchLayer = () => {
                const newLayer = activeLayer === 0 ? 1 : 0;
                if (canvasRef.current) {
                    canvasRef.current.setActiveLayer(newLayer);
                    setActiveLayer(newLayer);
                }
            };

            React.useEffect(() => {
                // Initialize canvas
                const canvas = new fabric.Canvas('canvas', {
                    width: 600,
                    height: 400
                });
                
                // Create layers manager
                const layersManager = new FabricLayers.LayersManager(canvas);
                layersManager.addLayer('Layer 1');
                layersManager.addLayer('Layer 2');
                
                // Store reference
                canvasRef.current = canvas;

                return () => {
                    canvas.dispose();
                };
            }, []);

            return (
                <div>
                    <div className="controls">
                        <button onClick={addRectangle}>Add Rectangle</button>
                        <button onClick={addCircle}>Add Circle</button>
                        <button onClick={switchLayer}>
                            Switch to Layer {activeLayer === 0 ? '2' : '1'}
                        </button>
                        <span style={{marginLeft: '10px'}}>
                            Active Layer: {activeLayer + 1}
                        </span>
                    </div>
                    <canvas id="canvas"></canvas>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Demo />);
    </script>
</body>
</html>